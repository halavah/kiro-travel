# 05. é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ—…æ¸¸æœåŠ¡ç³»ç»Ÿçš„ä»£ç ç»“æ„å’Œç»„ç»‡æ–¹å¼ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
kiro-travel/
â”œâ”€â”€ app/                    # Next.js App Router ä¸»ç›®å½•
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±ç›®å½•
â”‚   â”‚   â”œâ”€â”€ auth/          # è®¤è¯ç›¸å…³ API
â”‚   â”‚   â”‚   â”œâ”€â”€ login/     # ç™»å½• API
â”‚   â”‚   â”‚   â”œâ”€â”€ register/  # æ³¨å†Œ API
â”‚   â”‚   â”‚   â””â”€â”€ me/        # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ spots/         # æ™¯ç‚¹ç›¸å…³ API
â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/      # åŠ¨æ€è·¯ç”±ï¼ˆæ™¯ç‚¹è¯¦æƒ…ã€æ›´æ–°ã€åˆ é™¤ï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ comments/   # æ™¯ç‚¹è¯„è®º
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ like/       # æ™¯ç‚¹ç‚¹èµ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ favorite/   # æ™¯ç‚¹æ”¶è—
â”‚   â”‚   â”‚   â””â”€â”€ route.ts  # æ™¯ç‚¹åˆ—è¡¨ã€åˆ›å»º
â”‚   â”‚   â”œâ”€â”€ categories/    # åˆ†ç±» API
â”‚   â”‚   â”œâ”€â”€ users/         # ç”¨æˆ· API
â”‚   â”‚   â”œâ”€â”€ cart/          # è´­ç‰©è½¦ API
â”‚   â”‚   â”œâ”€â”€ orders/        # è®¢å• API
â”‚   â”‚   â”œâ”€â”€ hotels/        # é…’åº— API
â”‚   â”‚   â”œâ”€â”€ activities/    # æ´»åŠ¨ API
â”‚   â”‚   â””â”€â”€ news/          # æ–°é—» API
â”‚   â”œâ”€â”€ (auth)/            # è®¤è¯é¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ login/         # ç™»å½•é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ register/      # æ³¨å†Œé¡µé¢
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ (main)/            # ä¸»è¦åŠŸèƒ½é¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ spots/         # æ™¯ç‚¹ç›¸å…³é¡µé¢
â”‚   â”‚   â”œâ”€â”€ profile/       # ç”¨æˆ·ä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ admin/         # ç®¡ç†åå°
â”‚   â”‚   â””â”€â”€ guide/         # å¯¼æ¸¸ä¸­å¿ƒ
â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx           # é¦–é¡µ
â”‚   â”œâ”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ loading.tsx        # åŠ è½½é¡µé¢
â”œâ”€â”€ components/            # React ç»„ä»¶ç›®å½•
â”‚   â”œâ”€â”€ ui/               # åŸºç¡€ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ form.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”œâ”€â”€ toast.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ layout/           # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ header.tsx    # é¡µå¤´
â”‚   â”‚   â”œâ”€â”€ footer.tsx    # é¡µè„š
â”‚   â”‚   â””â”€â”€ sidebar.tsx   # ä¾§è¾¹æ 
â”‚   â”œâ”€â”€ spots/            # æ™¯ç‚¹ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ spot-card.tsx
â”‚   â”‚   â”œâ”€â”€ spot-list.tsx
â”‚   â”‚   â”œâ”€â”€ spot-detail.tsx
â”‚   â”‚   â”œâ”€â”€ comment-list.tsx
â”‚   â”‚   â””â”€â”€ review-form.tsx
â”‚   â”œâ”€â”€ auth/             # è®¤è¯ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ login-form.tsx
â”‚   â”‚   â”œâ”€â”€ register-form.tsx
â”‚   â”‚   â””â”€â”€ auth-guard.tsx
â”‚   â”œâ”€â”€ forms/            # è¡¨å•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ spot-form.tsx
â”‚   â”‚   â”œâ”€â”€ ticket-form.tsx
â”‚   â”‚   â””â”€â”€ booking-form.tsx
â”‚   â””â”€â”€ common/           # é€šç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ loading.tsx
â”‚       â”œâ”€â”€ error.tsx
â”‚       â””â”€â”€ pagination.tsx
â”œâ”€â”€ contexts/             # React Context
â”‚   â””â”€â”€ auth-context.tsx  # è®¤è¯ä¸Šä¸‹æ–‡
â”œâ”€â”€ lib/                  # å·¥å…·åº“ç›®å½•
â”‚   â”œâ”€â”€ db.ts            # SQLite æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ db-utils.ts      # æ•°æ®åº“æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ auth.ts          # è®¤è¯å·¥å…·ï¼ˆJWTï¼‰
â”‚   â”œâ”€â”€ api-client.ts    # API è¯·æ±‚å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ utils.ts         # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ validations.ts   # æ•°æ®éªŒè¯è§„åˆ™
â”œâ”€â”€ types/                # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ auth.ts          # è®¤è¯ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ spot.ts          # æ™¯ç‚¹ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ user.ts          # ç”¨æˆ·ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ api.ts           # API å“åº”ç±»å‹
â”‚   â””â”€â”€ index.ts         # ç±»å‹å¯¼å‡º
â”œâ”€â”€ data/                 # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ travel.db        # SQLite æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ scripts/              # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ init-sqlite.mjs  # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ setup.mjs        # é¡¹ç›®åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ 001_create_tables.sql  # åˆ›å»ºè¡¨ç»“æ„
â”‚   â”œâ”€â”€ 002_enable_rls.sql     # è¡Œçº§å®‰å…¨ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ 003_create_triggers.sql # åˆ›å»ºè§¦å‘å™¨
â”‚   â””â”€â”€ 004_seed_data.sql       # æ’å…¥ç¤ºä¾‹æ•°æ®
â”œâ”€â”€ docs/                 # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ 01.é¡¹ç›®æ€»è§ˆ.md
â”‚   â”œâ”€â”€ 02.å¿«é€Ÿå¼€å§‹.md
â”‚   â”œâ”€â”€ 03.æ•°æ®åº“è®¾è®¡.md
â”‚   â”œâ”€â”€ 04.APIæ¥å£æ–‡æ¡£.md
â”‚   â”œâ”€â”€ 05.é¡¹ç›®ç»“æ„è¯´æ˜.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ public/               # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/          # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ icons/           # å›¾æ ‡
â”‚   â””â”€â”€ favicon.ico      # ç½‘ç«™å›¾æ ‡
â”œâ”€â”€ styles/              # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ globals.css      # å…¨å±€æ ·å¼
â”œâ”€â”€ .env.local           # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore          # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ package.json        # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json       # TypeScript é…ç½®
â”œâ”€â”€ tailwind.config.js  # Tailwind CSS é…ç½®
â”œâ”€â”€ next.config.mjs     # Next.js é…ç½®
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. Next.js App Router

ä½¿ç”¨ Next.js 13+ çš„ App Router æ¶æ„ï¼š
- åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¯ç”±
- æœåŠ¡ç«¯ç»„ä»¶ï¼ˆé»˜è®¤ï¼‰
- å®¢æˆ·ç«¯ç»„ä»¶ï¼ˆæ ‡è®° "use client"ï¼‰
- å¸ƒå±€åµŒå¥—
- å¹¶è¡Œè·¯ç”±

### 2. ç›®å½•è¯´æ˜

#### app/ ç›®å½•
Next.js 13+ çš„æ ¸å¿ƒç›®å½•ï¼ŒåŒ…å«ï¼š
- **api/**: API è·¯ç”±ï¼Œåç«¯é€»è¾‘
- **(auth)/**: è®¤è¯ç›¸å…³é¡µé¢ï¼Œä½¿ç”¨è·¯ç”±ç»„
- **(main)/**: ä¸»è¦åŠŸèƒ½é¡µé¢
- **layout.tsx**: æ ¹å¸ƒå±€ç»„ä»¶
- **page.tsx**: é¦–é¡µç»„ä»¶

#### components/ ç›®å½•
React ç»„ä»¶ç»„ç»‡ï¼š
- **ui/**: åŸºç¡€ UI ç»„ä»¶ï¼Œå¯å¤ç”¨
- **layout/**: å¸ƒå±€ç›¸å…³ç»„ä»¶
- **features/**: åŠŸèƒ½ç‰¹å®šç»„ä»¶
- **forms/**: è¡¨å•ç»„ä»¶

#### lib/ ç›®å½•
å·¥å…·åº“å’Œé…ç½®ï¼š
- æ•°æ®åº“è¿æ¥å’Œæ“ä½œ
- è®¤è¯é€»è¾‘
- API å®¢æˆ·ç«¯
- é€šç”¨å·¥å…·å‡½æ•°

#### types/ ç›®å½•
TypeScript ç±»å‹å®šä¹‰ï¼š
- API å“åº”ç±»å‹
- æ•°æ®æ¨¡å‹ç±»å‹
- ç»„ä»¶ Props ç±»å‹

### 3. ç»„ä»¶è®¾è®¡åŸåˆ™

1. **ç»„ä»¶åˆ†ç±»**
   - é¡µé¢ç»„ä»¶ï¼ˆPagesï¼‰ï¼šä½äº app/ ç›®å½•
   - å¸ƒå±€ç»„ä»¶ï¼ˆLayoutsï¼‰ï¼šå¤ç”¨çš„é¡µé¢å¸ƒå±€
   - åŠŸèƒ½ç»„ä»¶ï¼ˆFeaturesï¼‰ï¼šä¸šåŠ¡é€»è¾‘ç»„ä»¶
   - UI ç»„ä»¶ï¼ˆUIï¼‰ï¼šçº¯å±•ç¤ºç»„ä»¶

2. **ç»„ä»¶å‘½å**
   - ä½¿ç”¨ PascalCase
   - æ–‡ä»¶åä¸ç»„ä»¶åä¸€è‡´
   - ç›®å½•ç»“æ„åæ˜ åŠŸèƒ½æ¨¡å—

3. **æ•°æ®æµ**
   - ä½¿ç”¨ React Context è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†
   - ä½¿ç”¨ Server Components å‡å°‘å®¢æˆ·ç«¯è´Ÿæ‹…
   - ä½¿ç”¨ API Routes å¤„ç†æ•°æ®è¯·æ±‚

## ğŸ”§ å¼€å‘è§„èŒƒ

### 1. æ–‡ä»¶å‘½å

```
- ç»„ä»¶æ–‡ä»¶: ComponentName.tsx
- é¡µé¢æ–‡ä»¶: page.tsx
- å¸ƒå±€æ–‡ä»¶: layout.tsx
- åŠ è½½æ–‡ä»¶: loading.tsx
- é”™è¯¯æ–‡ä»¶: error.tsx
- API è·¯ç”±: route.ts
- å·¥å…·æ–‡ä»¶: utility-name.ts
- ç±»å‹æ–‡ä»¶: type-name.ts
```

### 2. å¯¼å…¥é¡ºåº

```typescript
// 1. React ç›¸å…³
import React from 'react'
import { useState, useEffect } from 'react'

// 2. Next.js ç›¸å…³
import Link from 'next/link'
import { useRouter } from 'next/navigation'

// 3. ç¬¬ä¸‰æ–¹åº“
import { z } from 'zod'
import { useForm } from 'react-hook-form'

// 4. å†…éƒ¨ç»„ä»¶ï¼ˆç»å¯¹è·¯å¾„ï¼‰
import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'

// 5. å·¥å…·å‡½æ•°
import { apiClient } from '@/lib/api-client'
import { formatDate } from '@/lib/utils'

// 6. ç±»å‹å®šä¹‰
import type { User } from '@/types/user'
```

### 3. TypeScript ä½¿ç”¨

```typescript
// ç»„ä»¶ Props ç±»å‹
interface SpotCardProps {
  spot: Spot
  onLike?: (id: number) => void
  className?: string
}

// ä½¿ç”¨æ³›å‹
interface ApiResponse<T> {
  success: boolean
  data: T
  error?: string
}

// è”åˆç±»å‹
type UserRole = 'user' | 'guide' | 'admin'
```

### 4. çŠ¶æ€ç®¡ç†

```typescript
// ä½¿ç”¨ Context ç®¡ç†å…¨å±€çŠ¶æ€
const { user, token, login, logout } = useAuth()

// ä½¿ç”¨ useState ç®¡ç†ç»„ä»¶çŠ¶æ€
const [loading, setLoading] = useState(false)
const [spots, setSpots] = useState<Spot[]>([])

// ä½¿ç”¨ useReducer ç®¡ç†å¤æ‚çŠ¶æ€
const [state, dispatch] = useReducer(formReducer, initialState)
```

## ğŸ“¦ ä¾èµ–ç®¡ç†

### æ ¸å¿ƒä¾èµ–

```json
{
  "next": "16.0.7",           // Next.js æ¡†æ¶
  "react": "19.2.0",          // React æ¡†æ¶
  "typescript": "^5",         // TypeScript
  "better-sqlite3": "^9.6.0", // SQLite æ•°æ®åº“
  "jsonwebtoken": "^9.0.2",   // JWT è®¤è¯
  "bcryptjs": "^2.4.3",       // å¯†ç åŠ å¯†
}
```

### UI ç›¸å…³

```json
{
  "@radix-ui/react-*": "latest", // Radix UI ç»„ä»¶
  "tailwindcss": "^4.1.9",       // CSS æ¡†æ¶
  "lucide-react": "^0.454.0",   // å›¾æ ‡åº“
  "recharts": "latest",          // å›¾è¡¨åº“
}
```

### å¼€å‘å·¥å…·

```json
{
  "@types/node": "^22",      // Node.js ç±»å‹
  "@types/react": "^19",     // React ç±»å‹
  "eslint": "*",             // ä»£ç æ£€æŸ¥
  "prettier": "*",           // ä»£ç æ ¼å¼åŒ–
}
```

## ğŸ”„ ä»£ç æµç¨‹

### 1. ç”¨æˆ·è®¤è¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ Login Form â†’ API /auth/login â†’ éªŒè¯å‡­æ® â†’ è¿”å› JWT â†’
å­˜å‚¨åˆ° localStorage â†’ æ›´æ–° AuthContext â†’ é‡å®šå‘åˆ°ä¸»é¡µ
```

### 2. æ•°æ®è·å–æµç¨‹

```
é¡µé¢ç»„ä»¶ â†’ useEffect â†’ API Client â†’ API Route â†’ æ•°æ®åº“æŸ¥è¯¢ â†’
è¿”å›æ•°æ® â†’ æ›´æ–°ç»„ä»¶çŠ¶æ€ â†’ æ¸²æŸ“ UI
```

### 3. è¡¨å•æäº¤æµç¨‹

```
è¡¨å•è¾“å…¥ â†’ React Hook Form â†’ Zod éªŒè¯ â†’ API Client â†’
API Route â†’ æ•°æ®éªŒè¯ â†’ æ•°æ®åº“æ“ä½œ â†’ è¿”å›ç»“æœ â†’ æ›´æ–° UI
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ Server Components å‡å°‘å®¢æˆ·ç«¯ JavaScript
- ä½¿ç”¨ dynamic åŠ¨æ€å¯¼å…¥éå…³é”®ç»„ä»¶
- ä½¿ç”¨ Image ç»„ä»¶ä¼˜åŒ–å›¾ç‰‡åŠ è½½
- ä½¿ç”¨ç¼“å­˜ç­–ç•¥å‡å°‘æ•°æ®åº“æŸ¥è¯¢

### 2. é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
try {
  const response = await apiClient.get('/api/spots')
  setSpots(response.data)
} catch (error) {
  console.error('Failed to fetch spots:', error)
  toast.error('è·å–æ™¯ç‚¹åˆ—è¡¨å¤±è´¥')
}
```

### 3. åŠ è½½çŠ¶æ€

```typescript
// ä½¿ç”¨ Suspense å¤„ç†åŠ è½½
<Suspense fallback={<SpotListSkeleton />}>
  <SpotList />
</Suspense>

// ç»„ä»¶å†…åŠ è½½çŠ¶æ€
{loading ? (
  <Spinner />
) : (
  <SpotList spots={spots} />
)}
```

### 4. ä»£ç åˆ†å‰²

```typescript
// åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶
const AdminDashboard = dynamic(() => import('./admin-dashboard'), {
  loading: () => <Spinner />,
  ssr: false,
})
```

## ğŸš€ éƒ¨ç½²ç›¸å…³

### 1. ç¯å¢ƒå˜é‡

```env
# .env.local
JWT_SECRET=your-secret-key
DB_PATH=./data/travel.db
```

### 2. æ„å»ºè¾“å‡º

```bash
npm run build  # ç”Ÿæˆ .next ç›®å½•
npm start      # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```

### 3. é™æ€èµ„æº

- public/ ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šè¢«å¤åˆ¶åˆ°æ„å»ºè¾“å‡º
- ä½¿ç”¨ /images/ è·¯å¾„è®¿é—®å›¾ç‰‡
- ä½¿ç”¨ next/image ä¼˜åŒ–å›¾ç‰‡æ€§èƒ½

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æ—¥å¿—

```typescript
// æœåŠ¡ç«¯æ—¥å¿—
console.log('Server:', data)

// å®¢æˆ·ç«¯æ—¥å¿—
console.log('Client:', error)
```

### 2. å¼€å‘å·¥å…·

- React DevTools
- Next.js DevTools
- SQLite Browser
- VS Code è°ƒè¯•å™¨

### 3. æ€§èƒ½åˆ†æ

```bash
# åˆ†æåŒ…å¤§å°
npm run build -- --analyze

# æ€§èƒ½æµ‹è¯•
npm run test:performance
```

## ğŸ“š æ‰©å±•æŒ‡å—

### 1. æ·»åŠ æ–°åŠŸèƒ½

1. åˆ›å»ºç›¸å…³ç±»å‹å®šä¹‰ï¼ˆtypes/ï¼‰
2. æ·»åŠ æ•°æ®åº“è¡¨ï¼ˆscripts/ï¼‰
3. åˆ›å»º API è·¯ç”±ï¼ˆapp/api/ï¼‰
4. å¼€å‘å‰ç«¯ç»„ä»¶ï¼ˆcomponents/ï¼‰
5. æ·»åŠ é¡µé¢ï¼ˆapp/ï¼‰

### 2. æ·»åŠ æ–°é¡µé¢

```typescript
// app/new-feature/page.tsx
export default function NewFeaturePage() {
  return <div>æ–°åŠŸèƒ½é¡µé¢</div>
}
```

### 3. æ·»åŠ æ–° API

```typescript
// app/api/new-feature/route.ts
import { NextRequest, NextResponse } from 'next/server'

export async function GET(request: NextRequest) {
  return NextResponse.json({ success: true, data: [] })
}
```

---

æœ¬æ–‡æ¡£éšç€é¡¹ç›®çš„å‘å±•ä¼šæŒç»­æ›´æ–°ï¼Œè¯·ä¿æŒå…³æ³¨ã€‚