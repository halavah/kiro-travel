# 07. å‰ç«¯å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ—…æ¸¸æœåŠ¡ç³»ç»Ÿå‰ç«¯å¼€å‘çš„è§„èŒƒã€ç»„ä»¶ä½¿ç”¨å’Œæœ€ä½³å®è·µã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Next.js 16**: React å…¨æ ˆæ¡†æ¶ï¼Œæ”¯æŒ App Router
- **React 19**: UI åº“ï¼Œæ”¯æŒ Server Components
- **TypeScript 5**: ç±»å‹å®‰å…¨çš„ JavaScript

### æ ·å¼æ–¹æ¡ˆ
- **Tailwind CSS 4**: åŸå­åŒ– CSS æ¡†æ¶
- **Radix UI**: æ— éšœç¢ UI ç»„ä»¶åº“
- **Lucide React**: å›¾æ ‡åº“

### çŠ¶æ€ç®¡ç†
- **React Context**: å…¨å±€çŠ¶æ€ç®¡ç†
- **useState/useReducer**: ç»„ä»¶å†…çŠ¶æ€
- **Server State**: æœåŠ¡ç«¯ç»„ä»¶çŠ¶æ€

### è¡¨å•å¤„ç†
- **React Hook Form**: é«˜æ€§èƒ½è¡¨å•åº“
- **Zod**: TypeScript ä¼˜å…ˆçš„æ•°æ®éªŒè¯
- **@hookform/resolvers**: é›†æˆéªŒè¯å™¨

## ğŸ“¦ ç»„ä»¶åº“ä½¿ç”¨

### 1. UI ç»„ä»¶ï¼ˆcomponents/uiï¼‰

æ‰€æœ‰åŸºç¡€ UI ç»„ä»¶ä½äº `components/ui` ç›®å½•ï¼ŒåŸºäº Radix UI æ„å»ºï¼š

```typescript
// ä½¿ç”¨ç¤ºä¾‹
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form'
```

#### å¸¸ç”¨ç»„ä»¶

1. **Button æŒ‰é’®ç»„ä»¶**
```typescript
<Button variant="default">é»˜è®¤æŒ‰é’®</Button>
<Button variant="outline">è¾¹æ¡†æŒ‰é’®</Button>
<Button variant="ghost">å¹½çµæŒ‰é’®</Button>
<Button size="sm">å°æŒ‰é’®</Button>
<Button disabled>ç¦ç”¨æŒ‰é’®</Button>
```

2. **Card å¡ç‰‡ç»„ä»¶**
```typescript
<Card>
  <CardHeader>
    <CardTitle>æ ‡é¢˜</CardTitle>
  </CardHeader>
  <CardContent>
    å†…å®¹
  </CardContent>
</Card>
```

3. **Input è¾“å…¥æ¡†**
```typescript
<Input placeholder="è¯·è¾“å…¥å†…å®¹" />
<Input type="password" />
<Input disabled />
```

4. **Dialog å¯¹è¯æ¡†**
```typescript
<Dialog open={open} onOpenChange={setOpen}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>æ ‡é¢˜</DialogTitle>
    </DialogHeader>
    å†…å®¹
  </DialogContent>
</Dialog>
```

### 2. è‡ªå®šä¹‰ç»„ä»¶

#### SpotCard æ™¯ç‚¹å¡ç‰‡
```typescript
// components/spots/spot-card.tsx
interface SpotCardProps {
  spot: Spot
  onLike?: (id: number) => void
  onFavorite?: (id: number) => void
  showActions?: boolean
}

export function SpotCard({ spot, onLike, onFavorite, showActions = true }: SpotCardProps) {
  return (
    <Card className="overflow-hidden hover:shadow-lg transition-shadow">
      <div className="aspect-video relative">
        <Image
          src={spot.images[0] || '/placeholder.jpg'}
          alt={spot.name}
          fill
          className="object-cover"
        />
        <Badge className="absolute top-2 right-2">
          {spot.category_name}
        </Badge>
      </div>
      <CardContent className="p-4">
        <h3 className="font-semibold text-lg mb-2">{spot.name}</h3>
        <p className="text-gray-600 text-sm mb-3 line-clamp-2">
          {spot.description}
        </p>
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-1">
            <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
            <span className="text-sm">{spot.average_rating.toFixed(1)}</span>
          </div>
          <span className="font-bold text-blue-600">Â¥{spot.price}</span>
        </div>
        {showActions && (
          <div className="flex gap-2 mt-3">
            <Button
              variant="outline"
              size="sm"
              onClick={() => onLike?.(spot.id)}
            >
              <Heart className="w-4 h-4 mr-1" />
              {spot.like_count}
            </Button>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

#### SearchBar æœç´¢æ 
```typescript
// components/common/search-bar.tsx
interface SearchBarProps {
  value: string
  onChange: (value: string) => void
  placeholder?: string
  onSearch?: (value: string) => void
}

export function SearchBar({ value, onChange, placeholder, onSearch }: SearchBarProps) {
  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && onSearch) {
      onSearch(value)
    }
  }

  return (
    <div className="relative max-w-md">
      <Search className="absolute left-3 top-3 text-gray-400 w-4 h-4" />
      <Input
        placeholder={placeholder || "æœç´¢..."}
        value={value}
        onChange={(e) => onChange(e.target.value)}
        onKeyPress={handleKeyPress}
        className="pl-10"
      />
    </div>
  )
}
```

## ğŸ¨ æ ·å¼ç³»ç»Ÿ

### 1. Tailwind CSS é…ç½®

```typescript
// tailwind.config.ts
import type { Config } from 'tailwindcss'

export default {
  content: ['./src/**/*.{js,ts,jsx,tsx,mdx}'],
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: '#3B82F6',
          50: '#EFF6FF',
          500: '#3B82F6',
          600: '#2563EB',
        }
      },
      animation: {
        'fade-in': 'fadeIn 0.5s ease-in-out',
        'slide-up': 'slideUp 0.3s ease-out',
      }
    }
  }
} satisfies Config
```

### 2. CSS å˜é‡

```css
/* app/globals.css */
:root {
  --color-primary: 59 130 246;
  --color-primary-foreground: 255 255 255;
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
}

[data-theme="dark"] {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
}
```

### 3. å“åº”å¼è®¾è®¡

```typescript
// ä½¿ç”¨ Tailwind å“åº”å¼å‰ç¼€
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
  {/* å†…å®¹ */}
</div>

// ä½¿ç”¨ CSS-in-JS å®ç°å¤æ‚å¸ƒå±€
const dynamicStyles = {
  width: '100%',
  '@media (min-width: 768px)': {
    width: '50%',
  }
}
```

## ğŸ“ è¡¨å•å¤„ç†

### 1. React Hook Form + Zod

```typescript
// ç™»å½•è¡¨å•ç¤ºä¾‹
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'

const loginSchema = z.object({
  email: z.string().email('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'),
  password: z.string().min(6, 'å¯†ç è‡³å°‘éœ€è¦ 6 ä½'),
})

type LoginFormData = z.infer<typeof loginSchema>

export function LoginForm() {
  const form = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
    defaultValues: {
      email: '',
      password: '',
    }
  })

  const onSubmit = async (data: LoginFormData) => {
    console.log(data)
    // å¤„ç†ç™»å½•é€»è¾‘
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>é‚®ç®±</FormLabel>
              <FormControl>
                <Input placeholder="è¯·è¾“å…¥é‚®ç®±" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="password"
          render={({ field }) => (
            <FormItem>
              <FormLabel>å¯†ç </FormLabel>
              <FormControl>
                <Input type="password" placeholder="è¯·è¾“å…¥å¯†ç " {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <Button type="submit" className="w-full">
          ç™»å½•
        </Button>
      </form>
    </Form>
  )
}
```

### 2. è‡ªå®šä¹‰è¡¨å•éªŒè¯

```typescript
// ä½¿ç”¨ Zod è‡ªå®šä¹‰éªŒè¯
const registerSchema = z.object({
  password: z.string()
    .min(6, 'å¯†ç è‡³å°‘éœ€è¦ 6 ä½')
    .regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/, 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—'),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´',
  path: ['confirmPassword'],
})
```

## ğŸ”„ æ•°æ®è·å–

### 1. Server Componentsï¼ˆæ¨èï¼‰

```typescript
// app/spots/page.tsx
async function getSpots() {
  const db = await getDb()
  const spots = await db.query('SELECT * FROM spots')
  return spots
}

export default async function SpotsPage() {
  const spots = await getSpots()

  return (
    <div>
      {spots.map((spot) => (
        <SpotCard key={spot.id} spot={spot} />
      ))}
    </div>
  )
}
```

### 2. Client Components æ•°æ®è·å–

```typescript
'use client'

export function SpotsList() {
  const [spots, setSpots] = useState<Spot[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchSpots()
  }, [])

  const fetchSpots = async () => {
    try {
      const response = await apiGet('/api/spots')
      if (response.success) {
        setSpots(response.data)
      }
    } catch (error) {
      console.error('Failed to fetch spots:', error)
    } finally {
      setLoading(false)
    }
  }

  if (loading) return <SpotListSkeleton />

  return (
    <div>
      {spots.map((spot) => (
        <SpotCard key={spot.id} spot={spot} />
      ))}
    </div>
  )
}
```

### 3. SWR/React Queryï¼ˆå¯é€‰ï¼‰

```typescript
// ä½¿ç”¨ SWR è¿›è¡Œæ•°æ®ç¼“å­˜
import useSWR from 'swr'

export function useSpots() {
  const { data, error, mutate } = useSWR('/api/spots', apiFetcher)

  return {
    spots: data?.data || [],
    loading: !data && !error,
    error,
    mutate
  }
}
```

## ğŸ¯ é¡µé¢å¼€å‘

### 1. é¡µé¢ç»“æ„

```typescript
// app/spots/[id]/page.tsx
import { notFound } from 'next/navigation'

async function getSpot(id: string) {
  const response = await apiGet(`/api/spots/${id}`)
  if (!response.success) {
    notFound()
  }
  return response.data
}

export async function generateMetadata({ params }: { params: { id: string } }) {
  const spot = await getSpot(params.id)
  return {
    title: spot.name,
    description: spot.description,
  }
}

export default async function SpotPage({ params }: { params: { id: string } }) {
  const spot = await getSpot(params.id)

  return (
    <div>
      <SpotDetail spot={spot} />
      <CommentList spotId={spot.id} />
    </div>
  )
}
```

### 2. åŠ¨æ€å¯¼å…¥å’Œä»£ç åˆ†å‰²

```typescript
'use client'

import dynamic from 'next/dynamic'

// åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶
const MapView = dynamic(() => import('@/components/map/map-view'), {
  loading: () => <div>åœ°å›¾åŠ è½½ä¸­...</div>,
  ssr: false, // ç¦ç”¨æœåŠ¡ç«¯æ¸²æŸ“
})

export function SpotPage() {
  return (
    <div>
      <SpotDetail />
      <MapView />
    </div>
  )
}
```

## ğŸ­ äº¤äº’å’ŒåŠ¨ç”»

### 1. Framer Motionï¼ˆå¯é€‰ï¼‰

```typescript
'use client'

import { motion, AnimatePresence } from 'framer-motion'

export function AnimatedList({ items }: { items: Item[] }) {
  return (
    <AnimatePresence>
      {items.map((item) => (
        <motion.div
          key={item.id}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -20 }}
          transition={{ duration: 0.3 }}
        >
          <ItemCard item={item} />
        </motion.div>
      ))}
    </AnimatePresence>
  )
}
```

### 2. CSS åŠ¨ç”»

```typescript
// ä½¿ç”¨ Tailwind CSS åŠ¨ç”»
<div className="animate-fade-in">
  <h1>æ ‡é¢˜</h1>
</div>

// è‡ªå®šä¹‰åŠ¨ç”»
<div className="animate-pulse hover:scale-105 transition-transform">
  å†…å®¹
</div>
```

## ğŸ” é”™è¯¯å¤„ç†

### 1. Error Boundaries

```typescript
// components/common/error-boundary.tsx
'use client'

export function ErrorBoundary({ children }: { children: React.ReactNode }) {
  return (
    <div className="error-boundary">
      {children}
    </div>
  )
}
```

### 2. åŠ è½½å’Œé”™è¯¯çŠ¶æ€

```typescript
// components/common/loading-state.tsx
export function LoadingState() {
  return (
    <div className="flex justify-center items-center p-8">
      <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
    </div>
  )
}

// components/common/error-state.tsx
export function ErrorState({ error, onRetry }: { error: string; onRetry?: () => void }) {
  return (
    <div className="text-center p-8">
      <p className="text-red-500 mb-4">{error}</p>
      {onRetry && (
        <Button onClick={onRetry}>é‡è¯•</Button>
      )}
    </div>
  )
}
```

## ğŸ“± å“åº”å¼è®¾è®¡

### 1. ç§»åŠ¨ä¼˜å…ˆ

```typescript
// ç§»åŠ¨ä¼˜å…ˆçš„å¸ƒå±€
<div className="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
  {/* å†…å®¹ */}
</div>

// å“åº”å¼å­—ä½“å¤§å°
<h1 className="text-2xl sm:text-3xl lg:text-4xl">
  æ ‡é¢˜
</h1>
```

### 2. ç§»åŠ¨ç«¯é€‚é…

```typescript
// ç§»åŠ¨ç«¯å¯¼èˆª
export function MobileMenu() {
  const [isOpen, setIsOpen] = useState(false)

  return (
    <>
      <Button
        className="md:hidden"
        onClick={() => setIsOpen(!isOpen)}
      >
        <Menu />
      </Button>
      {isOpen && (
        <div className="md:hidden fixed inset-0 z-50 bg-white">
          {/* ç§»åŠ¨ç«¯èœå•å†…å®¹ */}
        </div>
      )}
    </>
  )
}
```

## ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ

### 1. æš—é»‘æ¨¡å¼æ”¯æŒ

```typescript
// hooks/use-theme.ts
'use client'

export function useTheme() {
  const [theme, setTheme] = useState('light')

  useEffect(() => {
    const stored = localStorage.getItem('theme')
    if (stored) {
      setTheme(stored)
    }
  }, [])

  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light'
    setTheme(newTheme)
    localStorage.setItem('theme', newTheme)
    document.documentElement.setAttribute('data-theme', newTheme)
  }

  return { theme, toggleTheme }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å›¾ç‰‡ä¼˜åŒ–

```typescript
import Image from 'next/image'

// ä¼˜åŒ–å›¾ç‰‡åŠ è½½
<Image
  src={imageUrl}
  alt={alt}
  width={500}
  height={300}
  priority // ä¼˜å…ˆåŠ è½½
  placeholder="blur" // æ¨¡ç³Šå ä½
  blurDataURL="data:image/jpeg;base64,..."
  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
/>
```

### 2. æ‡’åŠ è½½

```typescript
import { lazy, Suspense } from 'react'

// æ‡’åŠ è½½ç»„ä»¶
const LazyChart = lazy(() => import('@/components/chart'))

function ChartPage() {
  return (
    <Suspense fallback={<div>åŠ è½½å›¾è¡¨ä¸­...</div>}>
      <LazyChart />
    </Suspense>
  )
}
```

### 3. è™šæ‹Ÿæ»šåŠ¨

```typescript
// å¤§åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList as List } from 'react-window'

function VirtualizedList({ items }: { items: any[] }) {
  const Row = ({ index, style }: any) => (
    <div style={style}>
      <ItemCard item={items[index]} />
    </div>
  )

  return (
    <List
      height={600}
      itemCount={items.length}
      itemSize={200}
    >
      {Row}
    </List>
  )
}
```

## ğŸ“ å¼€å‘è§„èŒƒ

### 1. å‘½åè§„èŒƒ

- **ç»„ä»¶å**: PascalCase (SpotCard)
- **æ–‡ä»¶å**: kebab-case (spot-card.tsx)
- **å˜é‡å**: camelCase (spotList)
- **å¸¸é‡å**: UPPER_SNAKE_CASE (API_BASE_URL)

### 2. ä»£ç ç»„ç»‡

```typescript
// å¯¼å…¥é¡ºåº
import React, { useState, useEffect } from 'react'
import Image from 'next/image'
import { Button } from '@/components/ui/button'
import { apiGet } from '@/lib/api-client'
import type { Spot } from '@/types/spot'

// ç»„ä»¶å®šä¹‰
export function SpotCard({ spot }: { spot: Spot }) {
  // Hooks
  const [loading, setLoading] = useState(false)

  // äº‹ä»¶å¤„ç†
  const handleClick = () => {
    // å¤„ç†é€»è¾‘
  }

  // æ¸²æŸ“
  return (
    <Card>
      {/* JSX */}
    </Card>
  )
}
```

### 3. TypeScript æœ€ä½³å®è·µ

```typescript
// ä½¿ç”¨æ¥å£å®šä¹‰ Props
interface SpotCardProps {
  spot: Spot
  onLike?: (id: number) => void
  className?: string
}

// ä½¿ç”¨æ³›å‹
interface ApiResponse<T> {
  success: boolean
  data: T
}

// ä½¿ç”¨è”åˆç±»å‹
type Theme = 'light' | 'dark'

// ä½¿ç”¨å·¥å…·ç±»å‹
type PartialSpot = Partial<Spot>
```

## ğŸš€ éƒ¨ç½²å‡†å¤‡

### 1. ç¯å¢ƒå˜é‡

```typescript
// .env.local
NEXT_PUBLIC_API_URL=http://localhost:3000/api
NEXT_PUBLIC_UPLOAD_URL=http://localhost:3000/uploads
```

### 2. æ„å»ºä¼˜åŒ–

```typescript
// next.config.mjs
export default {
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
  experimental: {
    optimizeCss: true,
  },
}
```

---

è¿™ä»½æŒ‡å—æ¶µç›–äº†å‰ç«¯å¼€å‘çš„å„ä¸ªæ–¹é¢ï¼Œéµå¾ªè¿™äº›è§„èŒƒå¯ä»¥å¸®åŠ©æ‚¨æ„å»ºé«˜è´¨é‡ã€å¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚